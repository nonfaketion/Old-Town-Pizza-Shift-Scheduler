<% include ./partials/headIsUser%>

  <!--dropdown menu  -->
  <div class="dropdown hide hidden-menu">
    <div class="dropdown-menu drop-menu-div">
      <a class="dropdown-item" onclick="addRowAbove()">Add Row Above</a>
      <a class="dropdown-item" onclick="addRowBelow()">Add Row Below</a>
      <a class="dropdown-item" onclick="removeRow()">Remove Row</a>
      <a class="dropdown-item" onclick="addColumnRight()">Add Column Right</a>
      <a class="dropdown-item" onclick="addColumnLeft()">Add Column Left</a>
      <a class="dropdown-item" onclick="addColumnEnd()">Add Column to End</a>
      <a class="dropdown-item" onclick="removeColumn()">Remove Column</a>
    </div>
  </div>




  <div class="table-responsive">
    <div class="text-context">
      <button class="btn btn-light" onclick="boldText()" type="button" name="boldButton"><b>B</b></button>
      <button class="btn btn-light" onclick="italicText()" type="button"><b>I</strong></b></button>
      <button class="btn btn-light" onclick="underlineText()" type="button"><b>U</strong></b></button>
      <button class="btn btn-light" onclick="justifyLeft()" type="button"><i class="fas fa-align-left"></i></button>
      <button class="btn btn-light" onclick="justifyCenter()" type="button"><i class="fas fa-align-center"></i></button>
      <button class="btn btn-light" onclick="justifyRight()" type="button"><i class="fas fa-align-right"></i></button>


    </div>

    <header class=" p-4 text-center">
      Schedule
    </header>
    <div class="dropdown font-color-menu">
      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuFont" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fas fa-palette"></i>
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuFont">
        <button class="dropdown-item" type="button" onclick="setfontColor('#d62c2c')">Red</button>
        <button class="dropdown-item" type="button" onclick="setfontColor('#395bad')">Blue</button>
        <button class="dropdown-item" type="button" onclick="setfontColor('#39ad3b')">Green</button>
        <button class="dropdown-item" type="button" onclick="setfontColor('#000')">Black</button>
      </div>
    </div>
    <div class="dropdown color-menu">
      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuHighlight" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fas fa-highlighter"></i>
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuHighlight">
        <button class="dropdown-item" type="button" onclick="setHighlightColor('#ed564b')">Red</button>
        <button class="dropdown-item" type="button" onclick="setHighlightColor('#aaafad')">Gray</button>
        <button class="dropdown-item" type="button" onclick="setHighlightColor('#efe51c')">Yellow</button>
      </div>
    </div>
    <div class="container-fluid">
      <div class="dropdown cell-color-menu">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuCell" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-table"></i>
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuCell">
          <button class="dropdown-item" type="button" onclick="setCellColor('#d61313')">Red</button>
          <button class="dropdown-item" type="button" onclick="setCellColor('#595959')">Gray</button>
          <button class="dropdown-item" type="button" onclick="setCellColor('#ffcd39')">Yellow</button>
            <button class="dropdown-item" type="button" onclick="setCellColor('#fff')">White</button>
        </div>
      </div>
      <div class="container-fluid">

    <div class="container-fluid">

        <table class="table table-condensed table-sm table-bordered table-hover schedule-table">

          <tbody>
            <tr class="row_0">
              <td class="col_0" contenteditable="true" scope="row"></td>
              <td class="col_1"></td>
              <td class="col_2"></td>
              <td class="col_3"></td>
              <td class="col_4"></td>
              <td class="col_5"></td>
              <td class="col_6"></td>
              <td class="col_7"></td>
              <td class="col_8"></td>
            </tr>
            <tr class="row_1">
              <td class="col_0" contenteditable="true" scope="row"></td>
              <td class="col_1"></td>
              <td class="col_2"></td>
              <td class="col_3"></td>
              <td class="col_4"></td>
              <td class="col_5"></td>
              <td class="col_6"></td>
              <td class="col_7"></td>
              <td class="col_8"></td>
            </tr>
            </tr>
            <tr class="row_2">
              <td class="col_0" contenteditable="true" scope="row"></td>
              <td class="col_1"></td>
              <td class="col_2"></td>
              <td class="col_3"></td>
              <td class="col_4"></td>
              <td class="col_5"></td>
              <td class="col_6"></td>
              <td class="col_7"></td>
              <td class="col_8"></td>
            </tr>
            </tr>
            <tr class="row_3">
              <td class="col_0" contenteditable="true" scope="row"></td>
              <td class="col_1"></td>
              <td class="col_2"></td>
              <td class="col_3"></td>
              <td class="col_4"></td>
              <td class="col_5"></td>
              <td class="col_6"></td>
              <td class="col_7"></td>4
              <td class="col_8"></td>
            </tr>
            </tr>
            <tr class="row_4">
              <td class="col_0" contenteditable="true" scope="row"></td>
              <td class="col_1"></td>
              <td class="col_2"></td>
              <td class="col_3"></td>
              <td class="col_4"></td>
              <td class="col_5"></td>
              <td class="col_6"></td>
              <td class="col_7"></td>
              <td class="col_8"></td>
            </tr>
            </tr>
            <tr class="row_5">
              <td class="col_0" contenteditable="true" scope="row"></td>
              <td class="col_1"></td>
              <td class="col_2"></td>
              <td class="col_3"></td>
              <td class="col_4"></td>
              <td class="col_5"></td>
              <td class="col_6"></td>
              <td class="col_7"></td>
              <td class="col_8"></td>
            </tr>
            <tr class="row_6">
              <td class="col_0" contenteditable="true" scope="row"></td>
              <td class="col_1"></td>
              <td class="col_2"></td>
              <td class="col_3"></td>
              <td class="col_4"></td>
              <td class="col_5"></td>
              <td class="col_6"></td>
              <td class="col_7"></td>
              <td class="col_8"></td>
            </tr>
            </tr>
          </tbody>
        </table>
      </div>


    </div>


    <script type="text/javascript">
      

var table = document.querySelector(".schedule-table tbody");
var tableData = document.querySelectorAll("td");
var rows = table.querySelectorAll("tr");
var colClassNum, currentRowNum;
var currentTarget;


for(var i = 0; i < tableData.length; i++){

    tableData[i].contentEditable = "true";
}
//add columns




function addColumnEnd(){


//handle inputs
 var rows = document.querySelectorAll(".schedule-table tbody tr");
 var rowstoArray = Array.from(rows);


rowstoArray.forEach(function(element){
      var newdata =   document.createElement("td");
       newdata.contentEditable = "true";
       newdata.classList.add("col_" + colClassNum);
       element.appendChild(newdata);
       refactorColNums();

});

}

function addColumnRight(){


//handle inputs
 var rows = document.querySelectorAll(".col_" + colClassNum);
 var rowstoArray = Array.from(rows);


rowstoArray.forEach(function(element){
      var newdata =   document.createElement("td");
      newdata.contentEditable = "true";
      newdata.classList.add("col" + (colClassNum+1));
    element.after(newdata);
    refactorColNums();
});
//TODO cycle through remaining classes and change column number

}


function addColumnLeft(){


//handle inputs
 var column = document.querySelectorAll(".col_" + colClassNum);
 var columntoArray = Array.from(column);


columntoArray.forEach(function(element){
      var newdata =   document.createElement("td");
      newdata.contentEditable = "true";
      newdata.classList.add("col" + (colClassNum-1));
    element.before(newdata);

});
refactorColNums();
  //TODO cycle through remaining classes and change column number

}




function removeColumnEnd(){

 var rows = document.querySelectorAll(".schedule-table tbody tr");
 var rowstoArray = Array.from(rows);


rowstoArray.forEach(function(element){
  console.log(element.lastElementChild);
    element.removeChild(element.lastElementChild);
});

}

function removeColumn(){

 var rows = document.querySelectorAll(".schedule-table tbody tr");
 var rowstoArray = Array.from(rows);


rowstoArray.forEach(function(element){

    var rowChildren = element.childNodes;
    for(var i = 0; i < rowChildren.length; i++){
      if(rowChildren[i].nodeType === 1){
        var classStr = rowChildren[i].classList;

        if(classStr.contains("col_" + colClassNum)){
          rowChildren[i].remove();
         }
      }

    }
    refactorColNums();

    console.log(rowChildren);

});

}





function addRowBelow(){
  var newRow = document.createElement("tr");
  newRow.classList.add("row_"+(currentRowNum+1));
  var currentRow = document.querySelector("tr");
  var currentRowChildren = currentRow.childNodes;
  for(var i = 0; i < currentRowChildren.length; i++){
      if(currentRowChildren[i].nodeType === 1){
        var newTd = document.createElement("td");
        newTd.contentEditable = "true";
        newTd.classList.add("col_" + i);
        newRow.appendChild(newTd);
      }


  }
  var targetRow = document.querySelector(".row_" + currentRowNum);
  targetRow.after(newRow);
  refactorRowNums();


}

function addRowAbove(){
  var newRow = document.createElement("tr");
  newRow.classList.add("row_"+(currentRowNum-1));
  var currentRow = document.querySelector("tr");
  var currentRowChildren = currentRow.childNodes;
  for(var i = 0; i < currentRowChildren.length; i++){
      if(currentRowChildren[i].nodeType === 1){
        var newTd = document.createElement("td");
        newTd.contentEditable = "true";
        newTd.classList.add("col_" + i);
        newRow.appendChild(newTd);
      }


  }
  var targetRow = document.querySelector(".row_" + currentRowNum);
  targetRow.before(newRow);
  refactorRowNums();

}

function removeRow(){
    var delRowTarget = document.querySelector(".row_"+ currentRowNum);
    delRowTarget.remove();
    refactorRowNums();

}







function refactorColNums(){

  var dataCount = 0;

 //handle inputs
  var rows = document.querySelectorAll(".schedule-table tbody tr");
  var rowstoArray = Array.from(rows);

  rowstoArray.forEach(function(element){
    var rowData = element.childNodes;
    dataCount = 0; //keep track of data class numbers

        //node list for each loop won't work and used i to calculate new col numbers
        for(var i = 0; i < rowData.length; i++){
          if(rowData[i].nodeType === 1){
            rowData[i].classList.replace(rowData[i].classList,"col_" + dataCount);
            dataCount++;

          }
        }

    });
}

function refactorRowNums(){
 var rows = document.querySelectorAll("tr");
 var rowsLength = rows.length;
 for(var i = 0; i < rowsLength; i++){
   if(rows[i].nodeType === 1){ //make sure node is an element
        rows[i].classList.replace(rows[i].classList, "row_" + i);
   }

 }
}

//hides menu onclick if dropdown is open
document.querySelector(".schedule-table").addEventListener("click", function(e){
  document.querySelector(".hidden-menu").classList.add("hide");
  var currentCol = e.target.className; //column
  colClassNum = parseInt(currentCol.slice(4));
  var currentRowStr = e.target.parentNode.className; //row
  currentRowNum = parseInt(currentRowStr.slice(4));
  currentTarget = e.target;
});

if (document.addEventListener) { // IE >= 9; other browsers
    document.querySelector(".schedule-table").addEventListener('contextmenu', function(e) {
        document.querySelector(".drop-menu-div").classList.add("show");
        document.querySelector(".hidden-menu").classList.remove("hide");
        document.querySelector(".drop-menu-div").style.top =  e.pageY + 'px';
        document.querySelector(".drop-menu-div").style.left = e.pageX + 'px';
        var currentCol = e.target.className; //column
        colClassNum = parseInt(currentCol.slice(4));
        var currentRowStr = e.target.parentNode.className; //row
        currentRowNum = parseInt(currentRowStr.slice(4));
        currentTarget = e.target;
        //console.log(currentColNum);
        e.preventDefault();


    }, false); // bubbles which is default anyway
} else { // IE < 9
    document.querySelector(".schedule-table").attachEvent('oncontextmenu', function() {
        alert("You've tried to open context menu");
        window.event.returnValue = false;
    });
}

document.addEventListener("keydown", function(e){
  var currentCol = e.target.className; //column
  colClassNum = parseInt(currentCol.slice(4));
  var currentRowStr = e.target.parentNode.className; //row
  currentRowNum = parseInt(currentRowStr.slice(4));

  console.log(e.keyCode);


  var tablerow = document.querySelectorAll("tr");
  var tableColumn = document.querySelector(".row_0").children;

  if(e.keyCode === 38){
    if(currentRowNum > 0){
      currentTarget = document.querySelector(".row_" + (currentRowNum-1) + " .col_" + colClassNum);
      currentTarget.focus();
    }


  }
  //down arrow
  if(e.keyCode === 40){
    if(currentRowNum < (tablerow.length -1)){
        currentTarget = document.querySelector(".row_" + (currentRowNum+1) + " .col_" + colClassNum);
        currentTarget.focus();
    }

  }
  //left arrow
  if(e.keyCode === 37){
    if(colClassNum > 0){
      currentTarget = document.querySelector(".row_" + (currentRowNum) + " .col_" + (colClassNum-1));
      currentTarget.focus();
    }

  }
  //right arrow
  if(e.keyCode === 39){
    if(colClassNum < (tableColumn.length -1)){
          currentTarget = document.querySelector(".row_" + (currentRowNum) + " .col_" + (colClassNum+1));
          currentTarget.focus();

    }

  }
  //b for bold text

  if(e.ctrlKey && e.keyCode === 66){
    e.preventDefault();
    e.stopPropagation();
    document.execCommand('bold');
  }
  if(e.ctrlKey && e.keyCode === 73){
    e.preventDefault();
    e.stopPropagation();
    document.execCommand('italic');
  }
  if(e.ctrlKey && e.keyCode === 85){
    e.preventDefault();
    e.stopPropagation();
    document.execCommand('underline');
  }
  if(e.shiftKey && e.keyCode === 69){
    e.preventDefault();
    e.stopPropagation();
    document.execCommand('justifyCenter',true,null);
  }
  if(e.shiftKey && e.keyCode === 76){
    e.preventDefault();
    e.stopPropagation();
    document.execCommand('justifyLeft',false,null);
  }
  if(e.shiftKey && e.keyCode === 82){
    e.preventDefault();
    e.stopPropagation();
    document.execCommand('justifyRight',true,null);
  }

});


function boldText(){
   document.execCommand('bold');
   currentTarget.focus();
}
function italicText(){
   document.execCommand('italic');
   currentTarget.focus();
}
function underlineText(){
   document.execCommand('underline');
   currentTarget.focus();
}
function justifyRight(){
    document.execCommand('justifyRight');
   currentTarget.focus();
}
function justifyLeft(){
   document.execCommand('justifyLeft');
   currentTarget.focus();
}
function justifyCenter(){
   document.execCommand('justifyCenter');
   currentTarget.focus();
}

function setHighlightColor(highColor){
  currentTarget.focus();
   document.execCommand('hilitecolor',false,highColor);
}
function setfontColor(fontColor){
  currentTarget.focus();
   document.execCommand('foreColor',false,fontColor);

}


function setCellColor(bgcolor){
  currentTarget.focus();
   currentTarget.style.backgroundColor = bgcolor;
}


</script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  


    
<% include ./partials/footer %>